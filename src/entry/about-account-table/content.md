---
path: /entry/about-account-table
created: '2021-10-07'
updated: '2021-10-08'
title: 'Accountテーブルについての所感を述べる.'
tags: [database, design]
---

## 記事の目的

データベースを必要とするアプリケーションで登場頻度が高いと思われるAccountテーブルについて考察を深める下地として作成している.

## 定義

記事中で取り扱うAccountテーブルとは、アプリケーションの中で一意の人物と特定できるデータを格納しているテーブルを指します. 想定される類似の呼び方は、Userテーブルとかを想定している.

記事中で取り扱うアプリケーションとは、企業内外でデータ利用する際に扱っているものを指し、以下の前提を踏まえている.

- 部門、部署、チーム、個人単位で共通のアカウントを利用していないこと

## Accountテーブルの役割

Accountテーブルの役割は、以下が挙げられると思われる.

- アプリケーションへログインを試みる際に、アプリケーションに対してログイン情報を提供してアプリケーション側が保持している情報と整合するかを確認する.

- アプリケーション上の利用できる情報範囲に対して制限を行うか判断する.

- アプリケーションを利用している際の操作手順を追跡する.

**アプリケーションを利用できる資格を持っているかどうかを判断する役割を持ち、アプリケーションを利用し、データを発信や更新する際、その操作を誰がしたのかを追跡できるようにするための役割があると思われる.**

利用資格や、情報範囲の制限はAccountテーブル自体ではなく、関連テーブルを参照することになると思われる. しかし、最小単位としてはAccountテーブルに紐づき格納されているデータを参照することになる.

## Accountテーブルに備える項目

### Id

- Idの生成方法をアプリケーション側で行うか、DB製品の機能に依るかはケースバイケースになるかと思う.

私見として、このケースでは、DB製品の機能は利用しないほうが望ましいと思う.
過去のプロジェクトで苦い思いをしているのだが、データベースの移植性の懸念があるからである.
データの運用方法とかに依存して一概にいえないのは承知だが、データの移植時にアカウントの整理も含めることがあった。その整理をした結果、アカウントを参照するありとあらゆる情報が他人のアカウントを参照することになった.

例

**Old** 

Account

| id      | name  | state |
| ------- | ----- | ----- |
| 1389245 | Bob   | none  |
| 1389246 | Alice | alive |
| 1389249 | John  | alive |

Post 

| id      | title  | author |
| ------- | ----- | ----- |
| 123456789 | Hello Post   |  1389245 |
| 234567890 | Information !| 1389245 |
| 345678901 | Report Program...  | 1389246 |

**Current **

Account

| id   | name  | state |
| ---- | ----- | ----- |
| 1    | Alice | alive |
| 2    | John  | alive |

Post 

| id      | title  | author |
| ------- | ----- | ----- |
| 1 | Hello Post   |  1 | 
| 2 | Information !| 1 |
| 3 | Report Program...  | 2 |

極端な例だが、実際の課題は複雑性は大きいもので途方にくれてしまった.

この項目で特定のアカウントが絞れるのが望ましいと思う.
値が、数字なのか、文字との組み合わせは、推測されない安全性とアプリケーションで表示する要件がある場合の取扱い方法になるかと思われる.
管理者権限を持っているアカウントが登録しているアカウントの一覧を閲覧したい場合などが挙げられる.

### Name

姓/名で構成される文化圏なら姓名で区切られた項目で管理すればいいが、様々な文化背景を持った人物を登録することがあるだろう. その場合は、以下のように項目を区切り、アプリケーション側で表示方法を工夫する必要があると思われる.

Account

| familiy | given | middle |
| ---- | ----- | ----- |
| John    | Kennedy | Fitzgerald |
| Charlotte  | Elizabeth  | null |
| 田中  | 太郎  | null |



日本の法律では、ミドルネームは認められておらず、名前の一部として登録し、名前として扱われる.

例) 田中マルクス闘莉王 など

設計を行う際には、法務部や人事部などが参照するかを確認することが必要になる.

名前に含めるという選択肢も取れるが、分離する要件が出てきた時に難しくなる.

また大抵はアプリケーション毎にAccountテーブルが乱立するより、共通のAccountテーブルとして管理する要件が発生する.

そしてその場合は、別プロジェクトの要件としてアプリケーションから切り出したほうが望ましい.

他のプロジェクトはそこを参照するのみで、更新権限を持たないことになる.

社内で取り扱うアプリケーションは共通で持ち、社外で取り扱うアプリケーションは逆にそのアプリケーションのみがアクセスできるようにしないといけない。

それは、外部の人物がアカウント登録する際には、プライバシーポリシーに同意することになるので、他のアプリケーションで取り扱うことを想定していない.

性質が異なるので要件のすり合わせは慎重になるべきかと思う.

### Term

データを復元したいまたは、保持するようにしたいなどでデータを消すわけにはいかない場合がある.

その場合に利用されるのは、 `delete_flg` のような項目が作成されるが、項目名と実態があっていないのが違和感として持っている.

アプリケーションからデータを表示しないのであれば`display` などの非表示に類する文言が当てはまると思う.

また別のアプローチとして、そのアカウントの有効期間を定義することだと思う.

Account

| id | name | start | end |
| ---- | ----- | ----- | ----- |
| 1    | Kennedy | 2020-10-11 | 2020-11-11 |
| 2  | Elizabeth  | 1980-01-11 | 2011-11-10 |
| 3  | Alice  | 2021-04-01 | 2999-12-31 |

