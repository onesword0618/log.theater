---
path: /entry/about-account-table
created: '2021-10-07'
updated: '2021-10-08'
title: 'Accountテーブルについての所感を述べる.'
tags: [database, design]
---

## 記事の目的

データベースを必要とするアプリケーションで登場頻度が高いと思われる Account テーブルについて考察を深める下地として作成している.

## 定義

記事中で取り扱う Account テーブルとは、アプリケーションの中で一意の人物と特定できるデータを格納しているテーブルを指します.想定される類似の呼び方は、User テーブルとかを想定している.

記事中で取り扱うアプリケーションとは、企業内外でデータ利用する際に扱っているものを指し、以下の前提を踏まえている.

- 部門、部署、チーム、個人単位で共通のアカウントを利用していないこと

## Account テーブルの役割

Account テーブルの役割は、以下が挙げられると思われる.

- アプリケーションへログインを試みる際に、アプリケーションに対してログイン情報を提供してアプリケーション側が保持している情報と整合するかを確認する.

- アプリケーション上の利用できる情報範囲に対して制限を行うか判断する.

- アプリケーションを利用している際の操作手順を追跡する.

**アプリケーションを利用できる資格を持っているかどうかを判断する役割を持ち、アプリケーションを利用し、データを発信や更新する際、その操作を誰がしたのかを追跡できるようにするための役割があると思われる.**

利用資格や、情報範囲の制限は Account テーブル自体ではなく、関連テーブルを参照することになると思われる. しかし、最小単位としては Account テーブルに紐づき格納されているデータを参照することになる.

## Account テーブルに備える項目

```
| id   | familiy   | given     | middle     | familiy_kana | given_kana | middle_kana        | birth     | sex    |
| ---- | --------- | --------- | ---------- | ------------ | ---------- | ------------------ | --------- | ------ |
| 0001 | John      | Kennedy   | Fitzgerald | じょん       | けねでぃ   | ふぃっつじぇらるど | 1917-5-29 | male   |
| 0002 | Charlotte | Elizabeth | null       | しゃーろっと | えりざべす | null               | 2000-1-1  | female |
| 0003 | 田中      | 太郎      | null       | tanaka       | taro       | null               | 1992-7-1  | male   |
```

社外のアプリケーションであるならここに `nickname` のようなアプリケーションに表示する名前の項目が、`familiy`,`given`,`middle`,`familiy_kana`,`given_kana`,`middle_kana` の代わりに定義されるかと思う.

### Id

アプリケーションの利用対象者としてこの `id` が割り当てられる.
仮定の話になるが、他の項目が重複していたとしてもこの項目で一意を決めることができる.

この項目のタイプは数字型か文字列型の選択が出てくるが、文字列を選択して更に固定長文字列で定義をするのが望ましい.

しかし、値が、数字なのか、文字との組み合わせは、攻撃者が推測できない組み合わせの安全性とアプリケーションで表示する要件がある場合の取扱い方法になるかと思われる.

### Name

姓/名で構成される文化圏なら姓名で区切られた項目で管理すればいいが、様々な文化背景を持った人物を登録することがあるだろう. その場合は、以下のように項目を区切り、アプリケーション側で表示方法を工夫する必要があると思われる.

Account

```
| familiy   | given     | middle     |
| --------- | --------- | ---------- |
| John      | Kennedy   | Fitzgerald |
| Charlotte | Elizabeth | null       |
| 田中      | 太郎      | null       |
```

日本の法律では、ミドルネームは認められておらず、名前の一部として登録し、名前として扱われる.

例) 田中マルクス闘莉王 など

設計を行う際には、法務部や人事部などが参照するかを確認することが必要になる.

日本の法律に合わせて名前に含めるという選択肢も取れるが、分離する要件が出てきた時に難しくなる.

また社内アプリケーションとしての観点では、アプリケーション毎に Account テーブルが乱立するより、共通の Account テーブルとして管理する要件が発生する.

そしてその登録、編集などは、別プロジェクトの要件として、別アプリケーションから切り出したほうが望ましい.

他のプロジェクトはそこを参照するのみで、更新権限を持たないことになる.

社内で取り扱うアプリケーションは共通で持ち、社外で取り扱うアプリケーションは逆にそのアプリケーションのみがアクセスできるようにしないといけない。

それは、外部の人物がアカウント登録する際には、プライバシーポリシーに同意することになるので、他のアプリケーションで取り扱うことを想定していない.

性質が異なるので要件のすり合わせは慎重になるべきかと思う.
